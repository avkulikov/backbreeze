// ============================================
// Utility Class
// ============================================

// Create utility classes from a Sass map.

@mixin bb-utility-class($config) {
  $no-mq: (
    '': false
  );

  $name: map-get($config, 'name');
  $prop: map-get($config, 'prop');
  $values: map-get($config, 'values');
  $pseudo: map-get($config, 'pseudo');

  $bps: map-get($config, 'bps');
  $bps: if($bps, map-merge($no-mq, $bps), $no-mq);

  $negative: if(index($bb-negative-properties, $prop), true, false);
  $directional: if(index($bb-directional-properties, $prop), true, false);

  @each $bp-name, $bp in $bps {
    @include bb-mq($bp) {
      @include bb-utility-class-helper(
        $name,
        $prop,
        $values,
        $negative,
        $bp-name,
        $directional
      );

      @if $pseudo {
        @each $pseudo-class in $pseudo {
          @include bb-utility-class-helper(
            $name,
            $prop,
            $values,
            $negative,
            $bp-name,
            $directional,
            $pseudo-class
          );
        }
      }
    }
  }
}

// Render helper mixin
@mixin bb-utility-class-helper(
  $name,
  $prop,
  $values,
  $negative,
  $bp-name,
  $directional,
  $pseudo: false
) {
  $bp-name: if(str-length($bp-name) > 0, '#{\@}#{$bp-name}', '');
  $name-negative: if($bb-namespace, '-#{$bb-namespace}#{$name}', '-#{$name}');

  $pseudo-name: if($pseudo, '#{\:}#{$pseudo}', '');
  $pseudo: if($pseudo, ':#{$pseudo}', '');

  $parent: if($pseudo == ':group-hover', '.group:hover', '');
  $pseudo-name: if($pseudo == ':group-hover', '#{\:}group-hover', $pseudo-name);
  $pseudo: if($pseudo == ':group-hover', '', $pseudo);

  // Directional props
  $prop-top: bb-insert-direction($prop, 'top');
  $prop-left: bb-insert-direction($prop, 'left');
  $prop-right: bb-insert-direction($prop, 'right');
  $prop-bottom: bb-insert-direction($prop, 'bottom');

  $prop-top-left: bb-insert-direction($prop, 'top-left');
  $prop-top-right: bb-insert-direction($prop, 'top-right');
  $prop-bottom-left: bb-insert-direction($prop, 'bottom-left');
  $prop-bottom-right: bb-insert-direction($prop, 'bottom-right');

  $is-border-radius: $prop == 'border-radius';

  @each $key, $val in $values {
    $negative-key: str-index($key, '-') == 1;
    $key: if(str-length($key) > 0, '-#{$key}', '');

    @if $negative-key {
      #{$parent}
        .#{$name-negative}#{str-slice($key, 2)}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop}: #{$val};
      }
      @if $negative {
        @warn '`Value `#{str-slice($key, 2)}: #{$val}` for property `#{$prop}` is negative. Negative values for `#{$prop}` are automatically generated. Please remove `#{str-slice($key, 2)}: #{$val}` for `#{$prop}`.';
      }
    } @else {
      // @debug $pseudo;
      // @debug $pseudo-name;
      #{$parent}
        .#{$bb-namespace}#{$name}#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop}: #{$val};
      }
    }

    @if $directional and not $is-border-radius {
      #{$parent}
        .#{$bb-namespace}#{$name}t#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}l#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-left}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}r#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-right}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}b#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-bottom}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}x#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-left}: #{$val};
        #{$prop-right}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}y#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top}: #{$val};
        #{$prop-bottom}: #{$val};
      }
    } @else if $is-border-radius {
      #{$parent}
        .#{$bb-namespace}#{$name}t#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top-left}: #{$val};
        #{$prop-top-right}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}l#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top-left}: #{$val};
        #{$prop-bottom-left}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}r#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top-right}: #{$val};
        #{$prop-bottom-right)}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}b#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-bottom-left}: #{$val};
        #{$prop-bottom-right)}: #{$val};
      }

      #{$parent}
        .#{$bb-namespace}#{$name}tl#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top-left}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}tr#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top-right}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}bl#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-bottom-left}: #{$val};
      }
      #{$parent}
        .#{$bb-namespace}#{$name}br#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-bottom-right)}: #{$val};
      }
    }

    @if $negative and type-of($val) == number and not $negative-key {
      #{$parent} .#{$name-negative}#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop}: -#{$val};
      }
    }

    @if $negative and
      $directional and
      type-of($val) ==
      number and not
      $negative-key
    {
      #{$parent}
        .#{$name-negative}t#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top}: -#{$val};
      }
      #{$parent}
        .#{$name-negative}l#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-left}: -#{$val};
      }
      #{$parent}
        .#{$name-negative}b#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-bottom}: -#{$val};
      }
      #{$parent}
        .#{$name-negative}r#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-right}: -#{$val};
      }
      #{$parent}
        .#{$name-negative}x#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-left}: -#{$val};
        #{$prop-right}: -#{$val};
      }
      #{$parent}
        .#{$name-negative}y#{$key}#{$pseudo-name}#{$bp-name}#{$pseudo} {
        #{$prop-top}: -#{$val};
        #{$prop-bottom}: -#{$val};
      }
    }
  }
}

@mixin bb-mq($mq: false, $media: all) {
  @if $mq == 'print' {
    @media print {
      @content;
    }
  } @else if type-of($mq) == 'number' {
    @media #{$media} and (min-width: #{$mq}) {
      @content;
    }
  } @else if type-of($mq) == 'string' {
    $general-mq: map-get($bb-bps, $mq);
    @if $general-mq {
      @media #{$media} and (min-width: #{$general-mq}) {
        @content;
      }
    } @else {
      @media #{$mq} {
        @content;
      }
    }
  } @else {
    @content;
  }
}

@function bb-insert-direction($prop, $dir) {
  $index: str-index($prop, '-');

  @if $index {
    @return str-insert($prop, '-#{$dir}', $index);
  }

  @return '#{$prop}-#{$dir}';
}
